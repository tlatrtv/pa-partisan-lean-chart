<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>PA Partisan Lean Evolution by Community Type</title>
<script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
<style>
body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#020617;color:#e5e7eb}
.header{padding:24px 32px;background:linear-gradient(135deg,#9333EA,#2563EB);color:white}
.header-text h1{margin:0 0 4px;font-size:24px;font-weight:700}
.header-text p{margin:0;font-size:14px;opacity:.95}
.content{padding:24px 32px 40px}
.description h2{margin:0 0 4px;font-size:18px;font-weight:600}
.description p{margin:0;font-size:13px;color:#d1d5db;line-height:1.5}
.chart-wrapper{margin-top:16px;padding:16px;background:#020617;border-radius:12px;box-shadow:0 20px 40px rgba(15,23,42,.8);opacity:0;transform:translateY(8px);transition:opacity .7s ease, transform .7s ease}
.chart-inner{display:flex;flex-direction:column;gap:16px}
.chart-panel{min-height:420px}
.chart-footer{display:flex;flex-wrap:wrap;gap:16px;align-items:flex-start;margin-top:4px}
.insight-panel{flex:1 1 260px;padding:14px 16px;border-radius:10px;background:#0b1220;border:1px solid #1f2937;font-size:13px;line-height:1.5}
.insight-panel h3{margin:0 0 6px;font-size:14px;font-weight:600}
.insight-panel p{margin:0}
.controls-panel{flex:1 1 260px;padding:12px 14px;border-radius:10px;background:#020617;border:1px solid #1f2937;font-size:12px}
.controls-row{display:flex;align-items:center;gap:10px;margin-bottom:8px}
#play-button{border:none;border-radius:999px;padding:6px 12px;font-size:12px;cursor:pointer;background:linear-gradient(135deg,#9333EA,#14b8a6);color:white;font-weight:500;box-shadow:0 8px 18px rgba(0,0,0,.5)}
#play-button:hover{filter:brightness(1.05)}
#year-slider{flex:1}
.controls-meta{font-size:11px;color:#9ca3af}
.controls-meta span{font-weight:500;color:#e5e7eb}
.key-insights-panel{margin-top:16px;padding:14px 16px;border-radius:10px;background:#0b1220;border:1px solid #1f2937;font-size:13px;line-height:1.5}
.key-insights-panel h3{margin:0 0 6px;font-size:14px;font-weight:600}
.key-insights-panel ul{margin:4px 0 0 18px;padding:0}
.key-insights-panel li{margin-bottom:4px}
.context-box{margin-top:24px;padding:16px 20px;border-radius:10px;background:#0b1220;border:1px solid #1f2937;font-size:13px;line-height:1.4;opacity:0;transform:translateY(8px);transition:opacity .7s ease, transform .7s ease}
.context-box p{margin:0 0 8px}
.context-box p:last-child{margin-bottom:0}
.disclaimer{margin-top:16px;font-size:11px;color:#9ca3af}
.disclaimer p{margin:0}
.revealed{opacity:1 !important;transform:translateY(0) !important}
</style>
</head>
<body>

<div class='header'>
  <div class='header-text'>
    <h1>PA Partisan Lean Evolution by Community Type</h1>
    <p>Historical trends in voter registration across presidential election cycles (2008–2024)</p>
  </div>
</div>

<div class='content'>
  <div class='description'>
    <h2>Partisan Lean Evolution by Community Type</h2>
    <p>This chart traces how party registration balance has evolved across presidential election cycles, revealing long-term patterns in how different community types have developed their civic participation cultures and engagement pathways. Click legend items to toggle lines. Hover over data points for details. Each line represents a single election year. Positive values indicate more Democratic registrations; negative values indicate more Republican registrations. Use the controls to focus on a specific year or hover over points for details.</p>
  </div>

  <div class='chart-wrapper' id='chart-wrapper'>
    <div class='chart-inner'>
      <div class='chart-panel'>
        <div id='partisan-chart' class='plotly-graph-div' style='height:420px;width:100%;'></div>
      </div>
      <div class='chart-footer'>
        <div class='insight-panel'>
          <h3>Community spotlight</h3>
          <p>In <span id='detail-year'>2024</span>, <strong><span id='detail-community'>Big Cities</span></strong> had a net partisan balance of <span id='detail-lean'>43 percentage points Democratic</span>, meaning registrations were <span id='detail-tilt'>more Democratic than Republican</span> in that community type.</p>
        </div>
      

        <div class='controls-panel'>
          <div class='controls-row'>
            <button id='play-button'>Play year timeline</button>
            <input type='range' id='year-slider' min='0' max='4' step='1' value='4'/>
          </div>
          <div class='controls-meta'>
            <div>Selected year: <span id='selected-year-label'>2024</span></div>
            <div>Tip: Drag the slider, press Play, or hover over the chart to explore changes by year and community type.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class='key-insights-panel'>
        <h3>Key insights</h3>
        <ul>
          <li><strong>Largest shift:</strong> Working Class Country has swung about 32 percentage points toward Republicans since 2008, the biggest move of any community type.</li>
          <li><strong>Most stable:</strong> Exurbs are the steadiest, with only about a 1 point range in net partisan lean across elections.</li>
          <li><strong>2024 partisan landscape:</strong> Big Cities are the most Democratic (around +43 points), followed by Urban Suburbs (+13) and College Towns (+1). Rural Middle America is the most Republican (around −36 points), with Working Class Country (−14) and Middle Suburbs (−10) also clearly Republican leaning.</li>
          <li><strong>Post‑2016 realignment:</strong> Compared with 2008–2012, Working Class Country is about 21 points more Republican and Rural Middle America about 15 points more Republican, while Urban Suburbs are about 5 points more Democratic on average.</li>
          <li><strong>Only flip:</strong> Working Class Country is the only community type that crosses from Democratic‑leaning to Republican‑leaning over this period.</li>
        </ul>
      </div>
  <div class='context-box' id='context-box'>
    <p><strong>Reading this chart:</strong> Values show the net partisan balance (Democratic % minus Republican %). Positive values indicate more Democratic registrations; negative values indicate more Republican registrations. The scale is fixed from -50 to +50 percentage points for consistent comparison.</p>
    <p>Watch for convergence or divergence patterns across cycles that reveal how different community types have developed distinct civic participation cultures and engagement pathways over the past 16 years.</p>
  </div>

  <div class='disclaimer'>
    <p>All findings reflect publicly available registration statistics from the Pennsylvania Department of State. County types are based on the American Communities Project classification scheme.</p>
  </div>
</div>


<script>
  (function() {
    const years = [2008, 2012, 2016, 2020, 2024];
    const communities = [
      "Big Cities",
      "Exurbs",
      "Urban Suburbs",
      "Working Class Country",
      "Rural Middle America",
      "Middle Suburbs",
      "College Towns"
    ];

    const valuesByYear = [
      [0.490188, -0.074054, 0.051695, 0.186695, -0.13355, -0.016611, 0.054018], // 2008
      [0.484164, -0.074042, 0.075895, 0.147918, -0.158797, -0.021624, 0.034077], // 2012
      [0.468114, -0.074933, 0.093759, 0.056568, -0.217498, -0.042369, 0.028393], // 2016
      [0.449601, -0.062325, 0.127041, -0.049874, -0.302865, -0.069927, 0.020429], // 2020
      [0.430115, -0.071151, 0.130541, -0.134676, -0.360361, -0.098438, 0.012121]  // 2024
    ];

    const colors = ["#2dd4bf","#60a5fa","#a855f7","#facc15","#fb7185"];

    const chartEl = document.getElementById("partisan-chart");
    const detailYearEl = document.getElementById("detail-year");
    const detailCommunityEl = document.getElementById("detail-community");
    const detailLeanEl = document.getElementById("detail-lean");
    const detailTiltEl = document.getElementById("detail-tilt");
    const selectedYearLabel = document.getElementById("selected-year-label");
    const playButton = document.getElementById("play-button");
    const slider = document.getElementById("year-slider");
    const chartWrapper = document.getElementById("chart-wrapper");
    const contextBox = document.getElementById("context-box");

    let currentYearIndex = null; // null means 'all years lit'
    let playing = false;
    let timer = null;

    function buildTraces() {
      return years.map((yr, idx) => ({
        x: communities,
        y: valuesByYear[idx],
        mode: "lines+markers",
        name: String(yr),
        line: { shape: "spline", width: 2.5, color: colors[idx] },
        marker: { size: 6, opacity: 1 }
      }));
    }

    function formatLean(value) {
      const pct = value * 100;
      const sign = pct >= 0 ? "+" : "";
      return sign + pct.toFixed(0) + " percentage points";
    }

    function updateNarrative(yearIndex, communityIndex) {
      const yr = years[yearIndex];
      const community = communities[communityIndex];
      const value = valuesByYear[yearIndex][communityIndex];

      if (detailYearEl) detailYearEl.textContent = yr;
      if (detailCommunityEl) detailCommunityEl.textContent = community;
      if (detailLeanEl) detailLeanEl.textContent = formatLean(value);
      if (detailTiltEl) {
        if (value > 0.0000001) {
          detailTiltEl.textContent = "more Democratic than Republican";
        } else if (value < -0.0000001) {
          detailTiltEl.textContent = "more Republican than Democratic";
        } else {
          detailTiltEl.textContent = "roughly balanced between parties";
        }
      }
      if (selectedYearLabel) selectedYearLabel.textContent = yr;
    }

    function resetNarrative() {
      if (selectedYearLabel) {
        selectedYearLabel.textContent = "All years (2008–2024)";
      }
      // Keep the last-focused narrative rather than blanking it out
    }

    function clearYearHighlight() {
      if (!chartEl || !chartEl.data) return;
      const data = chartEl.data;
      for (let i = 0; i < data.length; i++) {
        Plotly.restyle(chartEl, {
          "marker.opacity": [1],
          "marker.size": [6],
          "line.width": [2.5]
        }, [i]);
      }
      currentYearIndex = null;
    }

    function highlightYear(yearIndex) {
      if (!chartEl || !chartEl.data) return;
      const data = chartEl.data;
      for (let i = 0; i < data.length; i++) {
        const isActive = (i === yearIndex);
        Plotly.restyle(chartEl, {
          "marker.opacity": [isActive ? 1 : 0.2],
          "marker.size": [isActive ? 9 : 5],
          "line.width": [isActive ? 3.2 : 1.5]
        }, [i]);
      }
      currentYearIndex = yearIndex;
    }

    function setYearIndex(idx, communityIndexOverride) {
      const communityIndex = (typeof communityIndexOverride === "number")
        ? communityIndexOverride
        : 0; // default Big Cities

      highlightYear(idx);
      updateNarrative(idx, communityIndex);
      if (slider) slider.value = String(idx);
    }

    function setupChart() {
      const layout = {
        hovermode: "x unified",
        template: "plotly_dark",
        margin: { l: 60, r: 40, t: 30, b: 160 },
        paper_bgcolor: "#020617",
        plot_bgcolor: "#020617",
        xaxis: {
          tickangle: 30,
          title: "",
          tickfont: { color: "#ffffff" },
          titlefont: { color: "#ffffff" },
          gridcolor: "#4b5563",
          gridwidth: 1
        },
        yaxis: {
          range: [-0.5, 0.5],
          tickformat: ".0%",
          tick0: 0,
          dtick: 0.25,
          zeroline: true,
          zerolinewidth: 2,
          zerolinecolor: "#e5e7eb",
          gridcolor: "#4b5563",
          gridwidth: 1,
          tickfont: { color: "#ffffff" },
          titlefont: { color: "#ffffff" },
          title: "Net Party Balance (D minus R)"
        },
        legend: {
          orientation: "h",
          x: 0.5,
          xanchor: "center",
          y: -0.45
        }
      };

      Plotly.newPlot(chartEl, buildTraces(), layout, {responsive: true})
        .then(() => {
          attachInteractions();
        });
    }

    function attachInteractions() {
      if (!chartEl) return;

      // Hover simply updates narrative and does NOT permanently change highlight
      chartEl.on("plotly_hover", function(e) {
        if (!e.points || !e.points.length) return;
        const pt = e.points[0];
        const yearIdx = years.indexOf(parseInt(pt.data.name, 10));
        const communityIdx = pt.pointIndex;

        updateNarrative(yearIdx, communityIdx);

        // temporary hover emphasis without altering overall year focus
        Plotly.restyle(chartEl, {
          "marker.size": [chartEl.data[yearIdx].marker.size.map((s, j) => j === communityIdx ? 10 : s)]
        }, [yearIdx]);
      });

      chartEl.on("plotly_unhover", function(e) {
        if (!chartEl || !chartEl.data) return;
        // restore marker sizes after hover
        chartEl.data.forEach((trace, i) => {
          Plotly.restyle(chartEl, {
            "marker.size": [trace.marker.size.map(() => (currentYearIndex === i ? 9 : 6))]
          }, [i]);
        });
      });

      if (slider) {
        slider.addEventListener("input", function() {
          const idx = parseInt(slider.value, 10);
          setYearIndex(idx);
        });
      }

      if (playButton) {
        playButton.addEventListener("click", function() {
          if (playing) return; // no pause toggle; one sweep per click
          playing = true;
          playButton.disabled = true;
          playButton.textContent = "Playing year sweep…";

          let idx = 0;
          setYearIndex(idx);

          timer = setInterval(function() {
            idx += 1;
            if (idx >= years.length) {
              clearInterval(timer);
              timer = null;
              playing = false;
              playButton.disabled = false;
              playButton.textContent = "Play year sweep";

              // Reset back to 'all years lit' state
              clearYearHighlight();
              resetNarrative();
              return;
            }
            setYearIndex(idx);
          }, 1100);
        });
      }

      // Scroll reveal
      if ("IntersectionObserver" in window) {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add("revealed");
            }
          });
        }, { threshold: 0.2 });

        if (chartWrapper) observer.observe(chartWrapper);
        if (contextBox) observer.observe(contextBox);
      } else {
        if (chartWrapper) chartWrapper.classList.add("revealed");
        if (contextBox) contextBox.classList.add("revealed");
      }
    }

    // Initialise: draw chart with all years equally visible, no highlighted year
    setupChart();
    resetNarrative();
  })();
</script>


</body>
</html>
